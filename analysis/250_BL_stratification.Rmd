---
title: "250_BL_comparisons"
author: "Carlos Bl√°zquez Bondia"
date: '2023-03-22'
output:
  html_document: default
  pdf_document: default
editor_options:
  chunk_output_type: console
---

# Group composition at Baseline

This is the very first comparison that should have been done. It wil contain all comparisons, be demographic or clinical at baseline.

## Demographic variables

As this study is an RCT, every referee will ask for the demographic distribution of both groups.
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(compareGroups)
```


```{r input, warning= F, message=FALSE}

mymre <- here::here("data", "filt_mre.rds") %>% 
  readRDS()


metadata <-
  here::here("Metadata") %>% 
    list.files(pattern = "clean_metadata", full.names = T) %>%
  file.info() %>% 
  dplyr::arrange(desc(ctime)) %>% 
  rownames() %>% 
  dplyr::first() %>% 
  read.csv()

```



```{r Demo_comps, warning = F, message = F}


metadata %>% 
  dplyr::filter(time_point == 0) %>% 
  group_by(group) %>% 
  compareGroups::compareGroups(group ~ age + gender + BMI + HIV_VL + CD4 + risk_group, data = .) %>% 
  compareGroups::createTable(x = .) %>% 
  compareGroups::export2md()


```



```{r clinical_comp}

igc<-metar::get_diversity(mymre)@igc
Threshold <-  igc@dataTable %>%
  dplyr::select(SampleID, NumberMappedReads) %>%
  unique() %>%
  summarise(Q = quantile(NumberMappedReads,0.02)) %>% 
  as.numeric()



igc_df <- igc@dataTable %>%
  filter(NumberMappedReads >= Threshold) %>%
  filter(ReadCountReal >= Threshold) %>% ### Get the Mapped Read count (per-sample) just above the threshold
  group_by(SampleID) %>%
  summarise(across(everything(), min)) %>%
  ungroup() %>%
  right_join(., metadata, by = "SampleID") %>%
  dplyr::filter(time_point == 0) %>% 
  compareGroups::compareGroups(group ~ age + gender + BMI + HIV_VL + CD4 + CD4_nadir + risk_group + GeneNumber, 
                               data = ., method = ) %>%
  compareGroups::createTable(x = .) %>%
  compareGroups::export2md()

igc_df


```

