<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Beta Diversity and NMDS</title>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/master/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">advanz4</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Beta Diversity and NMDS</h1>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2022-01-20
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 6 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 1
</p>
<p>
<strong>Knit directory:</strong> <code>advanz4/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.6.2). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguncommittedchanges"> <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> <strong>R Markdown file:</strong> uncommitted changes </a>
</p>
</div>
<div id="strongRMarkdownfilestronguncommittedchanges" class="panel-collapse collapse">
<div class="panel-body">
<p>The R Markdown file has unstaged changes. To know which version of the R Markdown file created these results, you’ll want to first commit it to the Git repo. If you’re still working on the analysis, you can ignore this warning. When you’re finished, you can run <code>wflow_publish</code> to commit the R Markdown file and build the HTML.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20211203code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20211203)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20211203code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20211203)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomMicrobialGenomicsadvanz4tree3643e0437b8e5013f59c804b42fd053e763b694ftargetblank3643e04a"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/MicrobialGenomics/advanz4/tree/3643e0437b8e5013f59c804b42fd053e763b694f" target="_blank">3643e04</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomMicrobialGenomicsadvanz4tree3643e0437b8e5013f59c804b42fd053e763b694ftargetblank3643e04a" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility.
</p>
<p>
The results in this page were generated with repository version <a href="https://github.com/MicrobialGenomics/advanz4/tree/3643e0437b8e5013f59c804b42fd053e763b694f" target="_blank">3643e04</a>. See the <em>Past versions</em> tab to see a history of the changes made to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .Rhistory
    Ignored:    .Rproj.user/
    Ignored:    data/mre.rds

Unstaged changes:
    Modified:   advanz4.Rproj
    Modified:   analysis/NMDS.Rmd

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were made to the R Markdown (<code>analysis/NMDS.Rmd</code>) and HTML (<code>docs/NMDS.html</code>) files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/MicrobialGenomics/advanz4/blob/3643e0437b8e5013f59c804b42fd053e763b694f/analysis/NMDS.Rmd" target="_blank">3643e04</a>
</td>
<td>
cblazquez-irsi
</td>
<td>
2022-01-19
</td>
<td>
Rewrote Biplot generation in a tidyverse manner
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="r-markdown" class="section level2">
<h2>R Markdown</h2>
<p>This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <a href="http://rmarkdown.rstudio.com" class="uri">http://rmarkdown.rstudio.com</a>.</p>
<p>When you click the <strong>Knit</strong> button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:</p>
<pre><code>suggested package selbal vsuggested package DataExplorer vsuggested package lme4 vsuggested package merTools v</code></pre>
</div>
<div id="including-plots" class="section level2">
<h2>Including Plots</h2>
<p>You can also embed plots, for example:</p>
<pre class="r"><code>myPath&lt;-here::here()
setwd(myPath)
mymre&lt;-readRDS(&quot;data/mre.rds&quot;)</code></pre>
<pre><code>Warning: namespace &#39;ggside&#39; is not available and has been replaced
by .GlobalEnv when processing object &#39;&lt;unknown&gt;&#39;</code></pre>
<pre class="r"><code>metadata &lt;- metar::get_metadata(mymre)@metadata_df

myphyloseq&lt;-mymre@taxa@metaphlan@phyloseq
CategoricalVariablesDF &lt;- get_metadata(mymre)@categorical_vals
NumericalVariablesDF &lt;- get_metadata(mymre)@numeric_vals
LongitudinalVariablesDF &lt;- get_metadata(mymre)@longitudinal_vals</code></pre>
<pre class="r"><code>getAbundances&lt;-function(phyloseq, level){
  
  collapsedPhyloseq&lt;- phyloseq::tax_glom(phyloseq, level)
  
  OtuTable&lt;- phyloseq::otu_table(collapsedPhyloseq) %&gt;%
    magrittr::set_rownames(as.character(phyloseq::tax_table(collapsedPhyloseq)[,level])) %&gt;%
    as.data.frame()
  return(OtuTable)
  
}




myAbundanceDF&lt;- getAbundances(myphyloseq, &quot;Species&quot;)

Top50&lt;- myAbundanceDF %&gt;%
    mutate(sum=rowSums(.)) %&gt;%
    arrange(desc(sum)) %&gt;%
    dplyr::slice(1:50) %&gt;%
    rownames()



myNMDS &lt;- myAbundanceDF %&gt;%
    # dplyr::filter(row.names(.) %in% Top50) %&gt;%
    t() %&gt;%
    as.data.frame() %&gt;%
 
    metaMDS(.,distance=&quot;bray&quot;,trymax=100, 
            k = nrow(unique(metadata[,CategoricalVariablesDF$CategoricalVariable[1]]))) %&gt;%
    pluck(&quot;points&quot;) %&gt;%
    as.data.frame() </code></pre>
<pre><code>Square root transformation
Wisconsin double standardization
Run 0 stress 0.1724211 
Run 1 stress 0.1727506 
... Procrustes: rmse 0.008020794  max resid 0.09660984 
Run 2 stress 0.175547 
Run 3 stress 0.1770523 
Run 4 stress 0.1742376 
Run 5 stress 0.1839672 
Run 6 stress 0.1785978 
Run 7 stress 0.1784786 
Run 8 stress 0.1754067 
Run 9 stress 0.1832022 
Run 10 stress 0.1737863 
Run 11 stress 0.1829618 
Run 12 stress 0.1736877 
Run 13 stress 0.1732637 
Run 14 stress 0.1806222 
Run 15 stress 0.1777061 
Run 16 stress 0.1844301 
Run 17 stress 0.1810641 
Run 18 stress 0.1826686 
Run 19 stress 0.1771014 
Run 20 stress 0.1737674 
Run 21 stress 0.1781841 
Run 22 stress 0.1775179 
Run 23 stress 0.184522 
Run 24 stress 0.175341 
Run 25 stress 0.1765879 
Run 26 stress 0.1756514 
Run 27 stress 0.1782388 
Run 28 stress 0.1761966 
Run 29 stress 0.1781504 
Run 30 stress 0.1909787 
Run 31 stress 0.1717816 
... New best solution
... Procrustes: rmse 0.01025499  max resid 0.09855546 
Run 32 stress 0.1750336 
Run 33 stress 0.1721063 
... Procrustes: rmse 0.0208961  max resid 0.291216 
Run 34 stress 0.1740108 
Run 35 stress 0.177154 
Run 36 stress 0.1869996 
Run 37 stress 0.1730058 
Run 38 stress 0.1778511 
Run 39 stress 0.1774592 
Run 40 stress 0.175148 
Run 41 stress 0.1759703 
Run 42 stress 0.1907783 
Run 43 stress 0.1761915 
Run 44 stress 0.1782163 
Run 45 stress 0.1762394 
Run 46 stress 0.1734224 
Run 47 stress 0.1736238 
Run 48 stress 0.1795013 
Run 49 stress 0.1742533 
Run 50 stress 0.1784198 
Run 51 stress 0.1741445 
Run 52 stress 0.1749171 
Run 53 stress 0.1721239 
... Procrustes: rmse 0.01008169  max resid 0.09854189 
Run 54 stress 0.1802702 
Run 55 stress 0.1848519 
Run 56 stress 0.179093 
Run 57 stress 0.1773489 
Run 58 stress 0.1720038 
... Procrustes: rmse 0.01013114  max resid 0.09645318 
Run 59 stress 0.1705821 
... New best solution
... Procrustes: rmse 0.008454777  max resid 0.09654334 
Run 60 stress 0.1742351 
Run 61 stress 0.1764294 
Run 62 stress 0.1840275 
Run 63 stress 0.1766158 
Run 64 stress 0.1782887 
Run 65 stress 0.1726587 
Run 66 stress 0.17674 
Run 67 stress 0.1975661 
Run 68 stress 0.1738075 
Run 69 stress 0.1743517 
Run 70 stress 0.1737663 
Run 71 stress 0.1735797 
Run 72 stress 0.1727276 
Run 73 stress 0.186374 
Run 74 stress 0.1739419 
Run 75 stress 0.1742648 
Run 76 stress 0.1868737 
Run 77 stress 0.1734269 
Run 78 stress 0.1796312 
Run 79 stress 0.1886951 
Run 80 stress 0.1840427 
Run 81 stress 0.1906154 
Run 82 stress 0.1751225 
Run 83 stress 0.1718234 
Run 84 stress 0.1772794 
Run 85 stress 0.1823349 
Run 86 stress 0.1879899 
Run 87 stress 0.1790072 
Run 88 stress 0.1788918 
Run 89 stress 0.174662 
Run 90 stress 0.1758027 
Run 91 stress 0.1779952 
Run 92 stress 0.173997 
Run 93 stress 0.1834311 
Run 94 stress 0.1747975 
Run 95 stress 0.1832628 
Run 96 stress 0.1911096 
Run 97 stress 0.1806206 
Run 98 stress 0.1730509 
Run 99 stress 0.1743672 
Run 100 stress 0.1741561 
*** No convergence -- monoMDS stopping criteria:
    57: no. of iterations &gt;= maxit
    41: stress ratio &gt; sratmax
     2: scale factor of the gradient &lt; sfgrmin</code></pre>
<pre class="r"><code>  # NMDS = data.frame(NMDS1 = dim_NMDS$points[,1], NMDS2 = dim_NMDS$points[,2])

BiPlotCoords&lt;- envfit(myNMDS, t(myAbundanceDF), perm=999) 

BiPlotCoordsDF &lt;- c(&quot;MDS1&quot;,&quot;MDS2&quot;,&quot;r&quot;,&quot;pvals&quot;) %&gt;%
  set_names() %&gt;%
  
  map_dfr(., ~ {
    
    if(.x %in% c(&quot;MDS1&quot;,&quot;MDS2&quot;)){
      BiPlotCoords$vectors$arrows[,.x] %&gt;%
        as.numeric()
    } else{
      BiPlotCoords$vectors %&gt;%
        pluck(.x) %&gt;%
        as.numeric()
    } 
      
  }) %&gt;%
  as.data.frame() %&gt;%
  set_names(nm=c(&quot;NMDS1&quot;,&quot;NMDS2&quot;,&quot;r&quot;,&quot;p&quot;)) %&gt;%
  dplyr::mutate(Dim1 = NMDS1*sqrt(r),
                Dim2 = NMDS2*sqrt(r),
                species = rownames(myAbundanceDF)) %&gt;%
  dplyr::filter(species %in% Top50)
  

myBrayDistMat &lt;-vegdist(wisconsin(sqrt(t(myAbundanceDF))))</code></pre>
</div>
<div id="nmds-by-treatment-group" class="section level2">
<h2>NMDS by Treatment group</h2>
<pre class="r"><code>long_var&lt;-LongitudinalVariablesDF$LongitudinalVariable[1]
cat_var &lt;- CategoricalVariablesDF$CategoricalVariable[1]
link_var &lt;- LongitudinalVariablesDF$LinkVariable[1]
id_var &lt;- &quot;SampleID&quot;

myPal&lt;-RColorBrewer::brewer.pal(name =  CategoricalVariablesDF$PaletteName[1],
                                n=length(unique(metadata[,cat_var])))

myNMDS_DF &lt;- myNMDS %&gt;%
  rownames_to_column(var = id_var) %&gt;%
  dplyr::full_join(., metadata, by =id_var) %&gt;%
  dplyr::select(SampleID = id_var,
                NMDS1 = MDS1,
                NMDS2 = MDS2,
                linkVar = !!sym(link_var),
                catVar = !!sym(cat_var),
                LongVar = long_var)


  myXmin&lt;-min(myNMDS$MDS1)
  # +(max(dim_NMDS$points[,1])-min(dim_NMDS$points[,1]))/20
  myYmin&lt;-max(myNMDS$MDS2)-(max(myNMDS$MDS1)-min(myNMDS$MDS1))



  
myAdonis&lt;- adonis(myBrayDistMat~ catVar, data = myNMDS_DF) %&gt;%
  pluck(&quot;aov.tab&quot;) %&gt;%
  as.data.frame() %&gt;%
  slice(1L) %&gt;%
  magrittr::set_rownames(cat_var)
  
  

myNMDSBiplot&lt;-ggplot(myNMDS_DF, aes(x=NMDS1, y=NMDS2)) + 
    geom_point(aes(colour=catVar, shape = as.character(LongVar)))+
    scale_colour_manual(values = myPal)+
    theme_bw()+
    theme(panel.border=element_blank(),
          panel.grid.major=element_blank(),
          panel.grid.minor=element_blank(),
          
          axis.line=element_line(colour=&quot;black&quot;),
          axis.text.x=element_text(size=11),
          axis.text.y=element_text(size=11),
          axis.title.x=element_text(size=11),
          axis.title.y=element_text(size=11),
          
          legend.text=element_text(size=11,face=&quot;italic&quot;),
          legend.title=element_text(size=11))+
    
    ggtitle(expression(atop(&quot;Species composition&quot;,atop(italic(&quot;all samples&quot;))))) +
    theme(plot.title=element_text(lineheight=1,face=&quot;bold&quot;,size=13))+
    stat_ellipse(geom=&quot;polygon&quot;,
                 alpha=0.15,color=&quot;black&quot;,
                 aes(fill=catVar),level=0.95)+
    scale_fill_manual(values=myPal)+
    # scale_size_manual(values = c(1:length(unique(myNMDS_DF[,&quot;LongVar&quot;])))/1.5) +
    geom_segment(data=BiPlotCoordsDF,aes(x=0,xend=Dim1,y=0,yend=Dim2),
                 arrow = arrow(length = unit(0.2,&quot;cm&quot;)),colour=&quot;darkgrey&quot;)+
    geom_text_repel(data=BiPlotCoordsDF,aes(Dim1,Dim2,label=species),
                    size=2.5, box.padding = unit(0.25, &quot;lines&quot;),
                    segment.colour=&quot;black&quot;,
                    segment.alpha=0.5,
                    segment.size=0.10)+
    coord_fixed()+
    labs(fill = cat_var, color=cat_var)


myNMDSBiplot</code></pre>
<p><img src="figure/NMDS.Rmd/NMDS_Group-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>No clear clustering apperaed either by group or Timepoint. In fact, most samples seem to cluster while some other seem to be dispersed along both ordinates</p>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 4.0.2 (2020-06-22)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 22000)

Matrix products: default

locale:
[1] LC_COLLATE=Spanish_Spain.1252  LC_CTYPE=Spanish_Spain.1252   
[3] LC_MONETARY=Spanish_Spain.1252 LC_NUMERIC=C                  
[5] LC_TIME=Spanish_Spain.1252    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] ggrepel_0.9.1   vegan_2.5-7     lattice_0.20-41 permute_0.9-5  
 [5] forcats_0.5.1   stringr_1.4.0   dplyr_1.0.7     purrr_0.3.4    
 [9] readr_2.0.1     tidyr_1.1.4     tibble_3.1.6    ggplot2_3.3.5  
[13] tidyverse_1.3.1 phyloseq_1.34.0 metar_0.1.4    

loaded via a namespace (and not attached):
  [1] utf8_1.2.2                tidyselect_1.1.1         
  [3] lme4_1.1-27.1             htmlwidgets_1.5.4        
  [5] grid_4.0.2                gmp_0.6-2                
  [7] pROC_1.18.0               munsell_0.5.0            
  [9] codetools_0.2-16          effectsize_0.4.5         
 [11] withr_2.4.3               colorspace_2.0-2         
 [13] Biobase_2.50.0            highr_0.9                
 [15] logger_0.2.2              knitr_1.36               
 [17] rstudioapi_0.13           stats4_4.0.2             
 [19] ipmisc_6.0.2              ggsignif_0.6.3           
 [21] labeling_0.4.2            emmeans_1.7.1-1          
 [23] git2r_0.28.0              polyclip_1.10-0          
 [25] farver_2.1.0              datawizard_0.2.0.1       
 [27] rhdf5_2.34.0              rprojroot_2.0.2          
 [29] coda_0.19-4               vctrs_0.3.8              
 [31] generics_0.1.1            xfun_0.28                
 [33] BWStest_0.2.2             R6_2.5.1                 
 [35] clue_0.3-59               arm_1.12-2               
 [37] BayesFactor_0.9.12-4.2    rhdf5filters_1.2.1       
 [39] cachem_1.0.1              reshape_0.8.8            
 [41] assertthat_0.2.1          promises_1.2.0.1         
 [43] networkD3_0.4             scales_1.1.1             
 [45] merTools_0.5.2            gtable_0.3.0             
 [47] Cairo_1.5-12.2            multcompView_0.1-8       
 [49] workflowr_1.6.2           rlang_0.4.11             
 [51] MatrixModels_0.5-0        zeallot_0.1.0            
 [53] GlobalOptions_0.1.2       PMCMRplus_1.9.0          
 [55] splines_4.0.2             broom_0.7.10             
 [57] yaml_2.2.1                reshape2_1.4.4           
 [59] abind_1.4-5               modelr_0.1.8             
 [61] backports_1.4.1           httpuv_1.6.3             
 [63] tools_4.0.2               ellipsis_0.3.2           
 [65] RColorBrewer_1.1-2        jquerylib_0.1.4          
 [67] biomformat_1.18.0         selbal_0.1.0             
 [69] BiocGenerics_0.36.1       WRS2_1.1-3               
 [71] Rcpp_1.0.7                plyr_1.8.6               
 [73] zlibbioc_1.36.0           pbapply_1.5-0            
 [75] GetoptLong_1.0.5          correlation_0.7.0        
 [77] S4Vectors_0.28.1          haven_2.3.1              
 [79] cluster_2.1.0             fs_1.5.0                 
 [81] here_1.0.1                DataExplorer_0.8.2       
 [83] magrittr_2.0.1            data.table_1.14.2        
 [85] circlize_0.4.13           reprex_2.0.1             
 [87] mvtnorm_1.1-2             whisker_0.4              
 [89] matrixStats_0.61.0        hms_1.1.1                
 [91] patchwork_1.1.1           mime_0.11                
 [93] evaluate_0.14             xtable_1.8-4             
 [95] pairwiseComparisons_3.1.6 broom.mixed_0.2.7        
 [97] readxl_1.3.1              IRanges_2.24.1           
 [99] gridExtra_2.3             shape_1.4.6              
[101] compiler_4.0.2            ggstatsplot_0.8.0        
[103] crayon_1.4.2              minqa_1.2.4              
[105] htmltools_0.5.2           mgcv_1.8-31              
[107] mc2d_0.1-21               later_1.3.0              
[109] tzdb_0.2.0                lubridate_1.8.0          
[111] DBI_1.1.1                 SuppDists_1.1-9.5        
[113] kSamples_1.2-9            tweenr_1.0.2             
[115] dbplyr_2.1.1              ComplexHeatmap_2.6.2     
[117] MASS_7.3-51.6             boot_1.3-25              
[119] Matrix_1.2-18             ade4_1.7-18              
[121] cli_3.0.1                 parallel_4.0.2           
[123] insight_0.14.4            igraph_1.2.9             
[125] pkgconfig_2.0.3           statsExpressions_1.1.0   
[127] xml2_1.3.2                paletteer_1.4.0          
[129] foreach_1.5.1             bslib_0.3.1              
[131] blme_1.0-5                multtest_2.46.0          
[133] XVector_0.30.0            estimability_1.3         
[135] rvest_1.0.1               digest_0.6.29            
[137] parameters_0.14.0         Biostrings_2.58.0        
[139] rmarkdown_2.11            cellranger_1.1.0         
[141] shiny_1.7.1               gtools_3.9.2             
[143] rjson_0.2.20              nloptr_1.2.2.3           
[145] lifecycle_1.0.1           nlme_3.1-148             
[147] jsonlite_1.7.2            Rhdf5lib_1.12.1          
[149] fansi_0.5.0               pillar_1.6.4             
[151] fastmap_1.1.0             httr_1.4.2               
[153] survival_3.1-12           glue_1.5.1               
[155] bayestestR_0.11.0         png_0.1-7                
[157] iterators_1.0.13          ggforce_0.3.3            
[159] stringi_1.7.6             sass_0.4.0               
[161] performance_0.7.3         rematch2_2.1.2           
[163] memoise_2.0.0             Rmpfr_0.8-4              
[165] ape_5.5                  </code></pre>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
